<!DOCTYPE html>
<html>
<head>
    <title>Segmentation Compare</title>
    <style>
        body { display: flex; flex-direction: row; height: 100vh; margin: 0; }
        .left-panel { width: 50%; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; background: #f7f7f7; }
        .controls-top { width: 90%; margin: 20px 0; padding: 20px; background: #e9e9e9; border-radius: 8px; box-shadow: 0 2px 8px #ccc; display: flex; flex-direction: row; align-items: center; justify-content: space-between; }
        .model-block { margin: 20px 0; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #ccc; width: 90%; }
        .controls { margin-top: 10px; }
        .controls a, .controls button { margin: 0 5px; }
        .right-panel { width: 50%; display: flex; justify-content: center; align-items: center; background: #222; }
        .page-img { max-width: 95%; max-height: 95vh; border: 2px solid #fff; border-radius: 8px; }
        .seg-img { max-width: 100%; max-height: 300px; border: 1px solid #888; border-radius: 4px; }
        .model-title { font-weight: bold; margin-bottom: 10px; }
        .padding-input { width: 60px; }
    </style>
</head>
<body>
    <div class="left-panel">
        <div class="controls-top" style="background:#fff; margin-bottom:10px; box-shadow:0 2px 8px #ccc;">
            <form method="post" action="{% url 'segment-finalize' doc_name page_name %}?model1={{ model1 }}&model2={{ model2 }}">
                {% csrf_token %}
                <button type="submit" name="finalize" value="1">Finalize Accepted Lines</button>
            </form>
        </div>
        <form class="controls-top" method="post" action="{% url 'segment-recreate' doc_name page_name %}?model1={{ model1 }}&model2={{ model2 }}">
            {% csrf_token %}
            <label for="padding">Padding:</label>
            <input class="padding-input" type="number" name="padding" id="padding" value="{{ padding|default:10 }}" min="0" max="100">
            <button type="submit" name="recreate" value="model1">Recreate {{ model1|escape }}</button>
            <button type="submit" name="recreate" value="model2">Recreate {{ model2|escape }}</button>
        </form>
        <div class="model-block">
            <div class="model-title">{{ model1|escape }} segmentation ({{ idx1|add:1 }}/{{ seg1_count }})</div>
            {% if seg1 %}
                <img class="seg-img" src="{{ seg1 }}" alt="Model 1 Segmentation">
            {% else %}
                <div>No segmentations found for model {{ model1|escape }}.</div>
            {% endif %}
            <div class="controls">
                {% if idx1 > 0 %}
                    <a href="?model1={{ model1 }}&model2={{ model2 }}&idx1={{ idx1|add:-1 }}&idx2={{ idx2 }}">Previous</a>
                {% else %}
                    <span>Previous</span>
                {% endif %}
                {% if seg1 and idx1 < seg1_count|add:-1 %}
                    <a href="?model1={{ model1 }}&model2={{ model2 }}&idx1={{ idx1|add:1 }}&idx2={{ idx2 }}">Next</a>
                {% else %}
                    <span>Next</span>
                {% endif %}
                {% if seg1 %}
                    <form method="get" style="display:inline;">
                        <input type="hidden" name="model1" value="{{ model1 }}">
                        <input type="hidden" name="model2" value="{{ model2 }}">
                        <input type="hidden" name="idx1" value="{{ idx1 }}">
                        <input type="hidden" name="idx2" value="{{ idx2 }}">
                        <input type="hidden" name="accept1" value="1">
                        <button type="submit">Accept</button>
                    </form>
                {% endif %}
            </div>
        </div>
        <div class="model-block">
            <div class="model-title">{{ model2|escape }} segmentation ({{ idx2|add:1 }}/{{ seg2_count }})</div>
            {% if seg2 %}
                <img class="seg-img" src="{{ seg2 }}" alt="Model 2 Segmentation">
            {% else %}
                <div>No segmentations found for model {{ model2|escape }}.</div>
            {% endif %}
            <div class="controls">
                {% if idx2 > 0 %}
                    <a href="?model1={{ model1 }}&model2={{ model2 }}&idx1={{ idx1 }}&idx2={{ idx2|add:-1 }}">Previous</a>
                {% else %}
                    <span>Previous</span>
                {% endif %}
                {% if seg2 and idx2 < seg2_count|add:-1 %}
                    <a href="?model1={{ model1 }}&model2={{ model2 }}&idx1={{ idx1 }}&idx2={{ idx2|add:1 }}">Next</a>
                {% else %}
                    <span>Next</span>
                {% endif %}
                {% if seg2 %}
                    <form method="get" style="display:inline;">
                        <input type="hidden" name="model1" value="{{ model1 }}">
                        <input type="hidden" name="model2" value="{{ model2 }}">
                        <input type="hidden" name="idx1" value="{{ idx1 }}">
                        <input type="hidden" name="idx2" value="{{ idx2 }}">
                        <input type="hidden" name="accept2" value="1">
                        <button type="submit">Accept</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="right-panel">
        {% if page_img %}
            <img class="page-img" src="{{ page_img }}" alt="Full Page">
        {% else %}
            <div style="color:#fff;">Full page image not found.</div>
        {% endif %}
    </div>
</body>
</html>